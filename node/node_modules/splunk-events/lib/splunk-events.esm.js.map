{"version":3,"file":"splunk-events.esm.js","sources":["../src/debounce.ts","../src/debounceStrategy.ts","../src/exponentialBackoffStrategy.ts","../src/request.ts","../src/splunk-events.ts"],"sourcesContent":["export interface DebouncedFn {\n  (): void\n  clear(): void\n}\n\nexport default function debounce<T>(\n  func: (...args: T[]) => void | Promise<void>,\n  wait = 100\n): DebouncedFn {\n  let timeout: NodeJS.Timeout | null = null\n  let cancel: (() => void) | null = null\n\n  const debounced = (...args: T[]) => {\n    if (timeout) {\n      clearTimeout(timeout)\n      timeout = null\n    }\n\n    return new Promise<void>((res, rej) => {\n      cancel = rej\n\n      timeout = setTimeout(() => {\n        const maybePromise = func(...args)\n\n        if (maybePromise != null) {\n          maybePromise.then(res).catch(rej)\n        }\n      }, wait)\n    })\n  }\n\n  debounced.clear = () => {\n    if (!timeout) {\n      return\n    }\n\n    clearTimeout(timeout)\n    cancel?.()\n\n    timeout = null\n  }\n\n  return debounced\n}\n","import type { SplunkEvent, Strategy } from './strategy'\nimport type { DebouncedFn } from './debounce'\nimport debounce from './debounce'\n\nconst DEFAULT_DEBOUNCE_TIME = 2_000\n\nexport class DebounceStrategy implements Strategy {\n  private pendingEvents: SplunkEvent[] = []\n  private events: SplunkEvent[] = []\n\n  private isSendingEvents = false\n  private flushPending = false\n\n  private autoRetryFlush: boolean\n  private sendEvents: (events: SplunkEvent[]) => Promise<void>\n\n  public flushEvents: DebouncedFn\n\n  constructor({\n    debounceTime = DEFAULT_DEBOUNCE_TIME,\n    autoRetryFlush,\n    sendEvents,\n  }: {\n    debounceTime?: number\n    autoRetryFlush: boolean\n    sendEvents: (events: SplunkEvent[]) => Promise<void>\n  }) {\n    this.flushEvents = debounce(this.flushImpl, debounceTime)\n    this.autoRetryFlush = autoRetryFlush\n    this.sendEvents = sendEvents\n  }\n\n  public abort() {\n    this.flushEvents.clear()\n  }\n\n  public addEvent(event: SplunkEvent) {\n    this.events.push(event)\n  }\n\n  private flushImpl = () => {\n    if (this.isSendingEvents) {\n      this.flushPending = true\n\n      return\n    }\n\n    this.pendingEvents = Array.from(this.events)\n    this.events = []\n    this.isSendingEvents = true\n\n    this.sendEvents(this.pendingEvents)\n      .then(() => {\n        this.pendingEvents = []\n        this.isSendingEvents = false\n\n        if (!this.flushPending) {\n          return\n        }\n\n        this.flushPending = false\n\n        return this.flushImpl()\n      })\n      .catch(() => {\n        this.events = this.events.concat(this.pendingEvents)\n        this.pendingEvents = []\n        this.isSendingEvents = false\n\n        if (this.autoRetryFlush) {\n          this.flushEvents()\n        }\n      })\n  }\n}\n","import type { Strategy, SplunkEvent } from './strategy'\n\nconst DEFAULT_EXPONENTIAL_BACKOFF_LIMIT = 60_000\n\nexport class ExponentialBackoffStrategy implements Strategy {\n  private isBackoffInProgress = false\n  private maxNumberOfRetries = Infinity\n\n  private events: SplunkEvent[] = []\n  private pendingEvents: SplunkEvent[] = []\n  private exponentialBackoffLimit: number\n\n  private sendEvents: (events: SplunkEvent[]) => Promise<void>\n\n  constructor({\n    sendEvents,\n    exponentialBackoffLimit = DEFAULT_EXPONENTIAL_BACKOFF_LIMIT,\n    maxNumberOfRetries,\n  }: {\n    sendEvents: (events: SplunkEvent[]) => Promise<void>\n    exponentialBackoffLimit?: number\n    maxNumberOfRetries?: number\n  }) {\n    this.sendEvents = sendEvents\n    this.exponentialBackoffLimit = exponentialBackoffLimit\n    this.maxNumberOfRetries = maxNumberOfRetries ?? this.maxNumberOfRetries\n  }\n\n  public addEvent(event: SplunkEvent) {\n    this.events.push(event)\n  }\n\n  public flushEvents(): Promise<void> {\n    if (this.isBackoffInProgress) {\n      return Promise.resolve()\n    }\n\n    this.isBackoffInProgress = true\n\n    const backoffMultiplier = 2\n\n    const executeFlush = (depth = 0): Promise<void> => {\n      this.pendingEvents = this.pendingEvents.concat(this.events)\n\n      this.events = []\n\n      return this.sendEvents(this.pendingEvents)\n        .then(() => {\n          this.pendingEvents = []\n          this.isBackoffInProgress = false\n\n          if (this.events.length > 0) {\n            return this.flushEvents()\n          }\n\n          return Promise.resolve()\n        })\n        .catch(() => {\n          const waitTime = backoffMultiplier ** depth * 1_000\n\n          if (depth > this.maxNumberOfRetries) {\n            this.events = []\n            this.isBackoffInProgress = false\n\n            return\n          }\n\n          return new Promise((resolve, reject) => {\n            setTimeout(() => {\n              executeFlush(depth + 1)\n                .then(resolve, reject)\n                .catch(reject)\n            }, Math.min(waitTime, this.exponentialBackoffLimit))\n          })\n        })\n    }\n\n    return executeFlush()\n  }\n}\n","export interface FetchContext extends Omit<RequestInit, 'body'> {\n  url: string\n  data: BodyInit\n  responseType: string\n}\n\nexport function fetchRequest(context: FetchContext) {\n  if (\n    (typeof window !== 'undefined' && typeof window.fetch !== 'function') ||\n    (typeof global !== 'undefined' &&\n      typeof (global as any).fetch !== 'function')\n  ) {\n    console.log('Error, using fetchRequest without fetch object')\n\n    return Promise.resolve(null)\n  }\n\n  return fetch(context.url, {\n    ...context,\n    body: context.data,\n  }).then((response) => {\n    if (context.responseType === 'json') {\n      return response.json()\n    }\n\n    return response\n  })\n}\n","import { DebounceStrategy } from './debounceStrategy'\nimport { ExponentialBackoffStrategy } from './exponentialBackoffStrategy'\nimport { FetchContext, fetchRequest } from './request'\nimport type { EventData, SplunkEvent, Strategy } from './strategy'\n\nexport { FetchContext }\n\nexport interface Config {\n  /**\n   * Whether or not to automatically flush batched events\n   * after calling {@link SplunkEvent#logEvent}.\n   *\n   * Turned on by default. This option will also be turned\n   * on when using `useExponentialBackoff`, regardless of the\n   * value passed the the configuration.\n   */\n  autoFlush?: boolean\n  /**\n   * Whether or not to automatically retry failed flushes.\n   */\n  autoRetryFlush?: boolean\n  /**\n   * Timeout, in milliseconds, used to batch events together in one single request.\n   */\n  debounceTime?: number\n  /**\n   * Wether or not to enable debugging of the {@link SplunkEvent} class\n   * itself.\n   */\n  debug?: boolean\n  /**\n   * Endpoint of your Splunk server.\n   */\n  endpoint: string\n  /**\n   * Host of your Splunk server.\n   */\n  host?: string\n  /**\n   * Whether or not to inject additional information about the user's\n   * device and browser in the Splunk event.\n   */\n  injectAdditionalInfo?: boolean\n  /**\n   * @deprecated Use `injectAdditionalInfo` instead\n   */\n  injectAditionalInfo?: boolean\n  /**\n   * Whether or not to automatically add the timestamp to the Splunk event.\n   */\n  injectTimestamp?: boolean\n  /**\n   * Path of the Splunk server endpoint.\n   */\n  path?: string\n  /**\n   * Custom request function to use in environments where {@link window.fetch}\n   * is not available.\n   */\n  request?: (fetchContext: FetchContext) => Promise<Response>\n  /**\n   * Whether or not to parse the event data in {@link SplunkEvent#logEvent}.\n   */\n  shouldParseEventData?: boolean\n  /**\n   * Source of the Splunk event.\n   */\n  source?: string\n  /**\n   * Token used to authenticate with the Splunk server.\n   */\n  token: string\n  /**\n   * Custom headers to be added in the request\n   */\n  headers?: HeadersInit\n  /**\n   * Configures the {@link SplunkEvent#flush} method to use an\n   * exponential backoff algorithm instead of a fixed debounce time.\n   *\n   * Turned off by default.\n   */\n  useExponentialBackoff?: boolean\n  /**\n   * Maximum time, in milliseconds, to use for the exponential backoff\n   * algorithm.\n   *\n   * The default limit is 60_000 milliseconds.\n   */\n  exponentialBackoffLimit?: number\n  /**\n   * Maximum number of retries of failed requests before dropping the events.\n   */\n  maxNumberOfRetries?: number\n}\n\nconst DEFAULT_USE_EXPONENTIAL_BACKOFF = false\n\nexport default class SplunkEvents {\n  private _requestImpl: (\n    fetchContext: FetchContext\n  ) => Promise<Response | null> = fetchRequest\n\n  private autoFlush = true\n  private debug = false\n  private endpoint?: string\n  private headers?: HeadersInit\n  private host = '-'\n  private injectAdditionalInfo = false\n  private injectTimestamp = false\n  private path = '/services/collector/event'\n  private shouldParseEventData = true\n  private source = 'log'\n  private token?: string\n\n  private configured = false\n\n  private flushStrategy: Strategy | null = null\n\n  constructor(config?: Config) {\n    if (!config) {\n      return\n    }\n\n    this.config(config)\n  }\n\n  /**\n   * Configure this Splunk Event instance.\n   */\n  public config(config: Partial<Config>) {\n    if (this.configured) {\n      return\n    }\n\n    this.configured = true\n\n    this.endpoint = config?.endpoint ?? this.endpoint // required\n    this.token = config?.token ?? this.endpoint // required\n    this.injectAdditionalInfo =\n      config?.injectAditionalInfo ??\n      config?.injectAdditionalInfo ??\n      this.injectAdditionalInfo\n\n    this.autoFlush = config?.autoFlush ?? this.autoFlush\n\n    this.source = config?.source ?? this.source\n    this.path = config?.path ?? this.path\n    this.host = config?.host ?? this.host\n    this.debug = config?.debug ?? this.debug\n\n    this._requestImpl = config?.request ?? this._requestImpl\n\n    this.injectTimestamp = config?.injectTimestamp ?? this.injectTimestamp\n    this.shouldParseEventData =\n      config?.shouldParseEventData ?? this.shouldParseEventData\n\n    this.headers = {\n      Authorization: `Splunk ${this.token}`,\n      'Content-Type': 'application/json',\n      ...(config?.headers ?? {}),\n    }\n\n    const useExponentialBackoff =\n      config?.useExponentialBackoff ?? DEFAULT_USE_EXPONENTIAL_BACKOFF\n\n    // Exponential backoff configurations\n    const exponentialBackoffLimit = config?.exponentialBackoffLimit\n    const maxNumberOfRetries = config?.maxNumberOfRetries\n\n    // Debounce configurations\n    const debounceTime = config?.debounceTime\n    const autoRetryFlush = config?.autoRetryFlush ?? true\n\n    if (useExponentialBackoff) {\n      this.autoFlush = true\n\n      this.flushStrategy = new ExponentialBackoffStrategy({\n        sendEvents: this.flush,\n        exponentialBackoffLimit,\n        maxNumberOfRetries,\n      })\n    } else {\n      this.flushStrategy = new DebounceStrategy({\n        sendEvents: this.flush,\n        debounceTime,\n        autoRetryFlush,\n      })\n    }\n  }\n\n  /**\n   * Logs an event to Splunk.\n   *\n   * This method will send the data to the Splunk endpoint configured\n   * in the {@link SplunkEvent#config} method. For now, you can only\n   * send primitive types such as string, numbers and booleans in the\n   * event data object.\n   *\n   * @argument level Level of criticity of this log, use values such as\n   * \"Critical\", \"Important\" or \"Debug\"\n   * @argument type Type of this log, use values such as \"Error\", \"Warn\"\n   * or \"Info\"\n   * @argument workflowType Type of this \"workflow\", you can use something\n   * related to your application domain, such as \"checkout\" for events happening\n   * in the Checkout page.\n   * @argument workflowInstance A more fine-grained level of information\n   * regarding the workflow, use values such as \"checkout-cart\" for events\n   * that happened in the Cart page of Checkout for example.\n   * @argument eventData Any custom event data you may find useful to log\n   * together that can provide more information.\n   * @argument account In multi-tenant environment it can be useful to know\n   * the exact account this event is happening in.\n   */\n  public logEvent = (\n    level: string,\n    type: string,\n    workflowType: string,\n    workflowInstance: string,\n    eventData?: EventData | null,\n    account = ''\n  ) => {\n    if (this.flushStrategy == null) {\n      throw new Error('SplunkEvents instance is not configured properly')\n    }\n\n    this.validateEvent(eventData)\n\n    const eventObj = {\n      level,\n      type,\n      workflowType,\n      workflowInstance,\n      account,\n      ...eventData,\n      ...(this.injectAdditionalInfo ? this.getAdditionalInfo() : {}),\n    }\n\n    const event = this.shouldParseEventData\n      ? this.parseEventData(eventObj)\n      : eventObj\n\n    const data = {\n      sourcetype: this.source,\n      host: this.host,\n      ...(this.injectTimestamp && { time: +new Date() }),\n      event,\n    }\n\n    this.flushStrategy.addEvent(data)\n\n    if (this.autoFlush) {\n      this.flushStrategy.flushEvents()\n    }\n  }\n\n  /**\n   * Exposes the implementation for the request function\n   * used to send the events to the Splunk API.\n   */\n  public request(fetchContext: FetchContext) {\n    return this._requestImpl(fetchContext)\n  }\n\n  private parseEventData(event: EventData) {\n    let parsedEvent = ''\n\n    for (const key in event) {\n      if (\n        Object.prototype.hasOwnProperty.call(event, key) &&\n        event[key] != null\n      ) {\n        const value = event[key]\n\n        switch (typeof value) {\n          case 'string':\n            parsedEvent += `${key}=\"${value.replace(/\"/g, '')}\" `\n            break\n\n          case 'boolean':\n\n          // eslint-disable-next-line no-fallthrough\n          case 'number':\n            parsedEvent += `${key}=${value} `\n            break\n\n          default:\n            throw new Error('Event property must be string, number or boolean')\n        }\n      }\n    }\n\n    return parsedEvent\n  }\n\n  private validateEvent(event?: EventData | null): asserts event is EventData {\n    if (event === null) {\n      throw new Error('Event must not be null')\n    }\n\n    if (event === undefined) {\n      throw new Error('Event must not be undefined')\n    }\n\n    if (typeof event !== 'object') {\n      throw new Error('Event must be an object')\n    }\n  }\n\n  public getAdditionalInfo() {\n    if (typeof navigator === 'undefined' || typeof window === 'undefined') {\n      return ''\n    }\n\n    const { screen, location } = window\n\n    const additionalInfo =\n      `${navigator.userAgent.replace(/,/g, ';')},` +\n      `${(navigator as any).browserLanguage || navigator.language},` +\n      `${navigator.platform},${screen.availWidth || '-'},${\n        screen.availHeight || '-'\n      },${location.hostname},` +\n      `${location.pathname},${location.protocol.replace(':', '')},${\n        location.hash || '-'\n      }`\n\n    return {\n      additional_info: additionalInfo,\n    }\n  }\n\n  /**\n   * Flushes pending events into one single request.\n   *\n   * You won't need to use this function unless you configured\n   * this instance to not auto flush the events.\n   */\n  public flush = async (events?: SplunkEvent[]): Promise<void> => {\n    this.validateConfig()\n\n    if (!events) {\n      this.flushStrategy!.flushEvents()\n\n      return\n    }\n\n    if (events.length === 0) {\n      return\n    }\n\n    if (this.debug) {\n      console.log(`sending ${events.length} events to splunk`)\n    }\n\n    const splunkBatchedFormattedEvents = this.formatEventsForSplunkBatch(events)\n\n    return this.request({\n      url: `${this.endpoint}${this.path}`,\n      method: 'POST',\n      data: splunkBatchedFormattedEvents,\n      headers: this.headers ?? {},\n      responseType: 'json',\n    })\n      .then(() => {\n        if (this.debug) {\n          console.log(`${events.length} events successfuly sent to splunk`)\n        }\n      })\n      .catch((e) => {\n        if (this.debug) {\n          console.warn('Error sending events to splunk.', e)\n        }\n\n        throw e\n      })\n  }\n\n  private formatEventsForSplunkBatch(events: SplunkEvent[]) {\n    return events.map((event) => JSON.stringify(event)).join('\\n')\n  }\n\n  private validateConfig() {\n    if (this.token == null) {\n      throw new Error('Token must not be null nor undefined')\n    }\n\n    if (this.endpoint == null) {\n      throw new Error('Endpoint must not be null nor undefined')\n    }\n\n    if (this.flushStrategy == null) {\n      throw new Error(\n        'Instance must be configured (either by constructor or calling config method) before flushing events'\n      )\n    }\n  }\n}\n"],"names":[],"mappings":"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"}